# 微信朋友圈智能爬虫 - 使用指南

## 🎯 功能 & 核心原理
主要是通过程序模拟人“点点点”保存图片信息；
- 支持：保存文本、图片、视频、时间戳；
- 不支持：保存超链接和评论。

只支持mac。windows好像打不开单独某个人的pyq界面。

注意：很破烂，我懒得改了。

```
1. 用户点击确定pyq区域
   ↓
2. 识别当前page下posts
   ↓
3. 依次点击进入详情页
   ↓
4. 第一次：用户点击文本首字符，程序记录位置
   之后：程序自动复制页面文字
   ↓
5. opencv识别图片位置，依次保存图片、识别timestamp
   ↓
6. 第一次：用户手动点返回，程序记录位置
   之后：程序自动点返回
   ↓
7. 回到列表，继续下一条
   ↓
8. 当前page识别完成，通过模版匹配scroll到下一页
   ↓
  重复2
  
```

## 🚀 开始使用

```bash
# 1. 安装依赖
brew install tesseract tesseract-lang
pip install -r requirements.txt

# 2. 运行
# 白天 -> 设置背景色
python3 wechat_crawler_wo_ref.py 255
# 晚上
python3 wechat_crawler_wo_ref.py 46

# 3. 按提示操作
#    - 选区域（1次）
#    - 手动首字符（1次）
#    - 手动返回（1次）
#    - 之后全自动！
```


## 🚀 使用步骤
### 第0步: 准备步骤
1. 先手动点击一幅要保存的图片，cmd+s，修改默认保存路径到程序里的图片保存文件夹；
2. 如果朋友圈有超链接/音乐转载，先点击后，调整弹出网页的位置，保证不遮挡pyq。

### 第1步：启动脚本

```bash
# 默认 46
python3 wechat_crawler_wo_ref.py
```

输出：
按Enter继续

---

### 第2步：选择区域（一次性）

1. 打开微信朋友圈
2. 移动鼠标到**内容区域左上角**
3. 按Enter
4. 移动鼠标到**内容区域右下角**
5. 按Enter

<img src=docs/Snipaste_2025-11-01_20-36-09.png width=50% />


✅ 完成！之后不再需要这步。

---

### 第3步：自动运行

脚本会自动：

**A. 找到当前页面各post位置**
```
  [0] 扫描屏幕...
  find 4 posts in this page
```

**B. 点击进入详情**
```
  等待详情页加载...
```

**C. 第一次复制文本（重要！）**
```
============================================================
步骤: 记录text start位置（仅需一次）
============================================================
请将光标指向“第一个字符”
然后按Enter，我会记录这个位置，之后就自动点击
============================================================

等待你将光标移到首字符...
```

**你需要做：**
1. 先点一下IDE/terminal
2. 手动将鼠标移到“第一个字符”
3. 按Enter

<img src=docs/Snipaste_2025-11-01_21-13-11.png width=50% />

```
  ✓ 已记录首字符位置: (994, 139)
    之后将自动点击此位置记录文本
```

**D. 保存图片**
```
开始保存图片...
  检测到 6 个图片区域
  保存 1/6...
  保存 2/6...
  ...
✓ 成功保存 6 张
```

**E. 第一次返回（重要！）**
```
============================================================
步骤: 记录返回按钮位置（仅需一次）
============================================================
请将光标移动到返回按钮（通常是左上角的 ← 或 ×）
然后按Enter，我会记录这个位置，之后就自动返回
============================================================

等待你将光标移到返回按钮...
```

**你需要做：**
1. 先点一下IDE/terminal
2. 手动将鼠标移到微信的返回按钮（←）
3. 按Enter

<img src=docs/Snipaste_2025-11-01_21-14-03.png width=50% />

```
✓ 已记录返回按钮位置: (982, 62)
  之后将自动点击此位置返回
```

**F. 之后全自动**

从第2条开始，完全自动：
```
✓ 完成第 1 条
  点击返回按钮: (982, 62)
  等待详情页加载...
  点击首字符: (994, 139)
  检测到 9 个图片区域
  保存 1/9...
  保存 2/9...
  保存 3/9...
  保存 4/9...
  保存 5/9...
  保存 6/9...
  保存 7/9...
  保存 8/9...
  保存 9/9...
✓ 成功保存 9 张
   ...
```

自动滚动、匹配、点击、保存、返回，无需你干预！

---

### 第4步：完成或中断

**完成：**
```
============================================================
抓取完成！
============================================================
✓ 总共抓取: 856 条
✓ 保存位置: wechat_moments
============================================================
```

**中断：**
- 按 `Ctrl+C`
- 进度自动保存
- 下次运行继续

## ⚙️ 配置调整

编辑 `config.yaml`，修改配置：

```yaml
   # 操作延迟设置（单位：秒）
   delays:
   click: 0.5           # 点击后的等待时间
   page_load: 1.0       # 页面加载等待时间
   scroll: 0.7          # 滚动后的等待时间
   back: 1.0            # 返回后的等待时间
   between_images: 0.6  # 保存图片之间的间隔
   hotkey: 0.3          # 按下快捷键后等待时间
```

祝抓取顺利！🎉